# NoneBot 语言工具箱 (Language Toolbox)

> 一个强大、智能且高度可配置的 NoneBot V11 语言处理插件。它集成了多种自动和手动语言功能，并提供了精细的控制选项，旨在打造一个无缝、无冲突的多语言聊天环境。

---

## ✨ 核心功能

### 对于普通用户

*   **智能自动翻译 (`Standard` 模式)**
    *   **外语识别**: 自动检测并翻译消息中的非中文内容（如英语、俄语等）。
    *   **日语专判**: 对包含日语假名的消息进行精准识别和翻译。
    *   **短语忽略**: 默认不翻译5个字符及以下的短语，避免打扰。

*   **自动中译英 (`CTE` 模式)**
    *   在特定模式下，自动将检测到的中文消息翻译为英文。

*   **自动繁简转换 (`Standard` 模式)**
    *   自动将繁体中文消息转换为简体，方便阅读。

*   **强大的手动翻译**
    *   使用 `/翻译` 或 `/fy` 指令，随时按需翻译。
    *   支持**回复消息翻译**和**直接文本翻译**两种模式。

### 防护与安全机制

*   **指令忽略**: **自动忽略**所有以 `/` 或 `!` 开头的消息，完美兼容其他机器人或插件的指令，杜绝冲突。
*   **网址保护**: **自动忽略**包含网址（`http://`, `https://`, `www.`）的消息，防止破坏链接或产生无效翻译。
*   **长度限制**: 为防止刷屏和API滥用，任何超过**200个字符**的文本都将被拒绝翻译（包括手动和自动）。
*   **用户黑名单**: 管理员可将特定用户加入黑名单，**屏蔽其所有自动功能**，但保留其手动使用指令的权限。

### 对于管理员

*   **模块化功能开关**: 可以为每个群组**独立开启或关闭** `Standard`（标准模式）和 `CTE`（中译英）两大功能模块。
*   **状态查询**: 随时查看指定群聊或所有群聊的功能开启状态。
*   **启用名单模式**: 插件默认在所有群聊中静默，需由管理员为指定群聊开启功能，避免对无关群聊造成打扰。

---

## 🛠️ 安装指南

1.  **放置插件文件**
    *   将 `language_tools.py` 文件放入您 NoneBot 项目的插件目录中 (例如 `src/plugins/`)。

2.  **安装依赖库**
    *   本插件需要 `httpx` 和 `opencc-python-reimplemented` 两个库。请在您的终端或命令行中运行：
    ```bash
    pip install httpx opencc-python-reimplemented
    ```

3.  **重启 NoneBot**
    *   重新启动您的 NoneBot 实例，插件即可加载并开始工作。

---

## 👑 管理员指南 (SuperUser)

本插件的所有管理功能都通过 `/lang` (或 `/语言工具`) 指令完成。

### 功能开关

您可以为一个群组同时开启 `standard` 和 `cte` 两种模式。

*   **启用模式**: `/lang enable <模式> [群号]`
    *   `<模式>`: `standard` 或 `cte`
    *   **示例**:
        *   `!lang enable standard 123456`  (在此群开启标准模式)
        *   `!lang enable cte 123456`       (在此群开启中译英模式)

*   **禁用模式**: `/lang disable <模式> [群号]`
    *   **示例**: `/lang disable cte 123456` (只关闭中译英，standard模式不受影响)

### 状态查询

*   **查看指定群状态**: `/lang status [群号]`
    *   会清晰地列出该群的 `standard` 和 `cte` 模式分别是开启还是关闭。
    *   **示例**: `/lang status 123456`

*   **查看所有群组设定**: `/lang list_groups`

### 用户黑名单管理

*   **添加用户至黑名单**: `/lang add_user [QQ号]`
    *   **示例**: `/lang add_user 987654321`

*   **从黑名单移除用户**: `/lang remove_user [QQ号]`
    *   **示例**: `/lang remove_user 987654321`

*   **查看黑名单列表**: `/lang list_users`

---

## 📖 普通用户使用说明

### 自动功能
在已启用本插件的群聊（且您不在黑名单中）或与机器人的私聊中：
*   **发送外语**: `hello world, this is a test` -> 机器人会自动翻译。
*   **发送繁体**: `妳好，世界` -> 机器人会自动转换为 `你好，世界`。
*   **发送中文 (CTE模式下)**: `你好` -> 机器人会自动翻译为 `Hello`。

### 手动翻译
*   **指令**: `/翻译` 或 `/fy`
*   **方式一 (回复)**: 回复一条消息，然后发送 `/翻译`。
*   **方式二 (文本)**: `/翻译 The quick brown fox`
*   **注意**: 待翻译的文本长度不能超过200个字符。

---

## 🧠 核心处理逻辑

为了确保功能强大且不冲突，插件的自动处理器遵循以下优先级：

1.  **外语翻译优先 (`standard` 模式)**: 如果消息被判定为外语，则翻译为中文，**流程结束**。
2.  **中译英次之 (`cte` 模式)**: 如果消息不是外语，但被判定为中文，则翻译为英文，**流程结束**。
3.  **繁简转换殿后 (`standard` 模式)**: 如果以上都不满足，最后检查是否为繁体字并进行转换。

这确保了任何一条消息最多只会被自动响应一次。
